version: "3.7"

x-stage-variables: &stage-variables
  - DJANGO_SECRET_KEY=
  - DJANGO_ALLOWED_HOSTS=
  - AWS_S3_BUCKET_NAME=

services:
  app:
    environment:  *stage-variables
    deploy:
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.{{ cookiecutter.project_slug }}StageApp.rule=Host(``) && (PathPrefix(`/admin`) || PathPrefix(`/api`))"
        - "traefik.http.routers.{{ cookiecutter.project_slug }}StageApp.entrypoints=web"
        - "traefik.http.services.{{ cookiecutter.project_slug }}StageApp.loadbalancer.server.port=8000"
        - "traefik.docker.network=shared_traefik"
